<style>
/* Import cute fonts to match main project */
@import url('https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,300;0,400;0,600;0,700;0,800;1,400&family=Comic+Neue:ital,wght@0,300;0,400;0,700;1,400&display=swap');

/* Cute font applications to match main project */
.cute-title {
  font-family: 'Comic Neue', cursive;
  font-weight: 700;
}

.cute-text {
  font-family: 'Nunito', sans-serif;
  font-weight: 400;
}

.cute-heading {
  font-family: 'Nunito', sans-serif;
  font-weight: 700;
}

.cute-subheading {
  font-family: 'Nunito', sans-serif;
  font-weight: 600;
}

/* City cards - clean sections with extended height */
.city-card {
  background: linear-gradient(135deg, 
    rgba(55, 65, 81, 0.95) 0%, 
    rgba(75, 85, 99, 0.95) 50%, 
    rgba(55, 65, 81, 0.95) 100%);
  border: 2px solid rgba(139, 92, 246, 0.3);
  backdrop-filter: blur(10px);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  padding: 24px 24px 80px 24px;  /* Added extra bottom padding for button space */
  margin: 32px 0;
  overflow: visible;
  transition: all 0.3s ease;
  position: relative;
  min-height: 220px;  /* Minimum height to ensure space */
}

/* LOCKED CITIES */
.city-card.locked {
  background: linear-gradient(135deg, 
    rgba(55, 65, 81, 0.4) 0%, 
    rgba(75, 85, 99, 0.4) 50%, 
    rgba(55, 65, 81, 0.4) 100%);
  border: 2px solid rgba(107, 114, 128, 0.3);
  opacity: 0.6;
  filter: grayscale(80%);
}

.city-card.locked h3 {
  color: #9ca3af !important;
}

.city-card.locked p, .city-card.locked div {
  color: #6b7280 !important;
}

.city-card.locked::after {
  content: '🔒 Complete previous city to unlock';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(31, 41, 55, 0.95);
  color: #9ca3af;
  padding: 12px 24px;
  border-radius: 25px;
  font-weight: 600;
  font-size: 14px;
  border: 1px solid rgba(107, 114, 128, 0.5);
  z-index: 10;
}

.city-card.unlocked {
  animation: unlockPulse 1s ease-out;
}

@keyframes unlockPulse {
  0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(139, 92, 246, 0.7); }
  50% { transform: scale(1.02); box-shadow: 0 0 0 20px rgba(139, 92, 246, 0); }
  100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(139, 92, 246, 0); }
}

/* Progress indicators on city cards */
.city-progress {
  position: absolute;
  top: 20px;
  right: 20px;
  background: rgba(139, 92, 246, 0.2);
  border: 1px solid rgba(139, 92, 246, 0.5);
  border-radius: 20px;
  padding: 6px 12px;
  font-size: 12px;
  font-weight: 600;
  color: #c084fc;
}

.city-progress.completed {
  background: rgba(16, 185, 129, 0.2);
  border: 1px solid rgba(16, 185, 129, 0.5);
  color: #10b981;
}

/* City icon styling - supports both images and emojis */
.city-icon {
  display: inline-block;
  margin-right: 12px;
  vertical-align: middle;
}

.city-icon img {
  width: 48px;
  height: 48px;
  border-radius: 8px;
  object-fit: cover;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  transition: all 0.3s ease;
  cursor: pointer;
}

.city-icon img:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 16px rgba(139, 92, 246, 0.4);
}

.city-icon.emoji {
  font-size: 48px;
  line-height: 1;
}

/* IMAGE MODAL/LIGHTBOX STYLES */
.image-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.9);
  backdrop-filter: blur(10px);
  z-index: 9999;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
}

.image-modal.show {
  opacity: 1;
  visibility: visible;
}

.image-modal-content {
  position: relative;
  max-width: 90vw;
  max-height: 90vh;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
  transform: scale(0.7);
  transition: transform 0.3s ease;
}

.image-modal.show .image-modal-content {
  transform: scale(1);
}

.image-modal img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  border-radius: 12px;
  max-width: 80vw;
  max-height: 80vh;
}

.image-modal-close {
  position: absolute;
  top: -10px;
  right: -10px;
  background: rgba(220, 38, 38, 0.9);
  color: white;
  border: none;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  font-size: 20px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
}

.image-modal-close:hover {
  background: rgba(185, 28, 28, 1);
  transform: scale(1.1);
}

.image-modal-title {
  position: absolute;
  bottom: -50px;
  left: 50%;
  transform: translateX(-50%);
  color: white;
  font-family: 'Nunito', sans-serif;
  font-weight: 600;
  font-size: 18px;
  text-align: center;
  background: rgba(0, 0, 0, 0.5);
  padding: 8px 16px;
  border-radius: 20px;
  backdrop-filter: blur(10px);
}

@media (max-width: 768px) {
  .city-card {
    padding: 16px 16px 70px 16px;  /* Adjusted bottom padding for mobile */
    margin: 20px 0;
    min-height: 200px;  /* Slightly smaller minimum height on mobile */
  }
  
  .city-icon img {
    width: 36px;
    height: 36px;
  }
  
  .city-icon.emoji {
    font-size: 36px;
  }
  
  .image-modal-content {
    padding: 10px;
  }
  
  .image-modal img {
    max-width: 95vw;
    max-height: 85vh;
  }
  
  .image-modal-title {
    font-size: 14px;
    bottom: -40px;
  }
}

/* ENHANCED: Route button back inside city card */
.city-route-button {
  position: absolute;
  bottom: 20px;  /* Back inside the card */
  right: 20px;
  font-size: 32px;
  background: rgba(31, 41, 55, 0.95);
  padding: 16px;
  border-radius: 50%;
  border: 2px solid rgba(139, 92, 246, 0.5);
  cursor: pointer;
  transition: all 0.3s ease;
  z-index: 10;
  text-decoration: none;
  display: inline-block;
  color: white;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
}

.city-route-button:hover {
  background: rgba(139, 92, 246, 0.2);
  border-color: rgba(139, 92, 246, 0.8);
  transform: scale(1.1);
  box-shadow: 0 8px 32px rgba(139, 92, 246, 0.4);
  color: white;
  text-decoration: none;
}

.city-route-button.locked {
  background: rgba(107, 114, 128, 0.3);
  border-color: rgba(107, 114, 128, 0.5);
  cursor: not-allowed;
  opacity: 0.5;
  pointer-events: none;
}

.city-route-button.locked:hover {
  transform: none;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
}

/* Special styling for San Diego start button */
.city-route-button.start-journey {
  background: linear-gradient(135deg, #10b981, #059669);
  border-color: rgba(16, 185, 129, 0.8);
  box-shadow: 0 0 24px rgba(16, 185, 129, 0.4);
  animation: startPulse 2s infinite;
}

.city-route-button.start-journey:hover {
  background: linear-gradient(135deg, #047857, #065f46);
  transform: scale(1.15);
  box-shadow: 0 8px 40px rgba(16, 185, 129, 0.6);
  color: white;
}

@keyframes startPulse {
  0%, 100% { box-shadow: 0 0 24px rgba(16, 185, 129, 0.4); }
  50% { box-shadow: 0 0 36px rgba(16, 185, 129, 0.8); }
}

/* XP and Theme indicators */
.city-xp {
  position: absolute;
  bottom: 20px;
  left: 20px;
  background: rgba(255, 215, 0, 0.2);
  border: 1px solid rgba(255, 215, 0, 0.5);
  border-radius: 20px;
  padding: 6px 12px;
  font-size: 12px;
  font-weight: 600;
  color: #ffd700;
}

.city-theme {
  display: inline-block;
  margin-top: 8px;
  font-size: 12px;
  color: #a78bfa;
  font-style: italic;
}

/* Data tag styling to match theme */
.data-tag {
  background: linear-gradient(135deg, #8b5cf6, #3b82f6);
  border: 2px solid rgba(139, 92, 246, 0.4);
  color: white;
  font-family: 'Nunito', sans-serif;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
  transition: all 0.3s ease;
}

.data-tag:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(139, 92, 246, 0.6);
  border: 2px solid rgba(139, 92, 246, 0.8);
}

/* Prerequisite button styling */
.prereq-button {
  background: linear-gradient(135deg, #8b5cf6, #3b82f6);
  border: 2px solid rgba(139, 92, 246, 0.4);
  padding: 12px 24px;
  border-radius: 25px;
  color: white;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-size: 12px;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
  position: relative;
  overflow: hidden;
  font-family: 'Nunito', sans-serif;
  text-decoration: none;
  display: inline-block;
}

.prereq-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(139, 92, 246, 0.6);
  border: 2px solid rgba(139, 92, 246, 0.8);
  color: white;
  text-decoration: none;
}

.prereq-button::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transition: left 0.5s ease;
}

.prereq-button:hover::before {
  left: 100%;
}

/* UNLOCK NOTIFICATION */
.unlock-notification {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: linear-gradient(135deg, #10b981, #059669);
  color: white;
  padding: 16px 32px;
  border-radius: 25px;
  font-weight: 600;
  font-size: 16px;
  z-index: 1000;
  box-shadow: 0 8px 32px rgba(16, 185, 129, 0.4);
  animation: slideInDown 0.5s ease-out;
}

@keyframes slideInDown {
  from { transform: translateX(-50%) translateY(-100px); opacity: 0; }
  to { transform: translateX(-50%) translateY(0); opacity: 1; }
}

/* Showcase Wall Styles - ADD TO EXISTING STYLES */
.showcase-wall {
  background: linear-gradient(135deg, 
    rgba(30, 30, 46, 0.95) 0%, 
    rgba(45, 45, 65, 0.95) 50%, 
    rgba(30, 30, 46, 0.95) 100%);
  border: 2px solid rgba(139, 92, 246, 0.3);
  border-radius: 16px;
  margin: 1rem 0;
  overflow: hidden;
  transition: all 0.3s ease;
}

.showcase-wall.locked {
  opacity: 0.5;
  border-color: rgba(107, 114, 128, 0.3);
}

.showcase-header {
  padding: 1rem 1.5rem;
  background: rgba(139, 92, 246, 0.1);
  border-bottom: 1px solid rgba(139, 92, 246, 0.2);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: space-between;
  transition: all 0.3s ease;
}

.showcase-header:hover {
  background: rgba(139, 92, 246, 0.15);
}

.showcase-toggle {
  font-size: 1.5rem;
  transition: transform 0.3s ease;
}

.showcase-toggle.expanded {
  transform: rotate(180deg);
}

.showcase-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease;
}

.showcase-content.expanded {
  max-height: 600px;
  overflow-y: auto;
}

.showcase-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1rem;
  padding: 1.5rem;
}

.showcase-item {
  background: rgba(55, 65, 81, 0.6);
  border: 1px solid rgba(139, 92, 246, 0.2);
  border-radius: 12px;
  padding: 1rem;
  transition: all 0.3s ease;
}

.showcase-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(139, 92, 246, 0.3);
}

.showcase-image {
  width: 100%;
  height: 120px;
  object-fit: cover;
  border-radius: 8px;
  margin-bottom: 0.75rem;
  cursor: pointer;
}

.showcase-caption {
  color: #e2e8f0;
  font-size: 0.9rem;
  line-height: 1.4;
  margin-bottom: 0.5rem;
}

.showcase-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 0.75rem;
  color: #a78bfa;
}

.upload-form {
  background: rgba(75, 85, 99, 0.3);
  border: 2px dashed rgba(139, 92, 246, 0.4);
  border-radius: 12px;
  padding: 1.5rem;
  text-align: center;
  margin: 1.5rem;
}

.upload-input, .upload-textarea {
  width: 100%;
  padding: 0.5rem;
  border: 1px solid rgba(139, 92, 246, 0.3);
  border-radius: 8px;
  background: rgba(30, 30, 46, 0.8);
  color: white;
  margin: 0.5rem 0;
  font-family: inherit;
}

.upload-textarea {
  min-height: 60px;
  resize: vertical;
}

.upload-button {
  background: linear-gradient(135deg, #8b5cf6, #3b82f6);
  border: none;
  padding: 0.75rem 1.5rem;
  border-radius: 8px;
  color: white;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-top: 1rem;
}

.upload-button:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
}

.city-upload-btn {
  position: absolute;
  top: 20px;
  left: 80px;
  background: rgba(59, 130, 246, 0.2);
  border: 1px solid rgba(59, 130, 246, 0.5);
  border-radius: 20px;
  padding: 6px 12px;
  font-size: 11px;
  font-weight: 600;
  color: #60a5fa;
  cursor: pointer;
  transition: all 0.3s ease;
  display: none;
}

.city-upload-btn:hover {
  background: rgba(59, 130, 246, 0.3);
  transform: scale(1.05);
}

.city-upload-btn.show {
  display: block;
}

@media (max-width: 768px) {
  .showcase-grid {
    grid-template-columns: 1fr;
    padding: 1rem;
  }
  .city-upload-btn {
    left: 60px;
    font-size: 10px;
    padding: 4px 8px;
  }
}
</style>

<div class="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900">
  <div class="container mx-auto px-8 py-16">

    {% if page.lxdData.Prequisites %}
    <div class="mb-16 text-center">
      <h3 class="text-2xl font-bold text-white mb-8 cute-heading">🎯 Prerequisites</h3>
      <ul class="flex flex-wrap gap-8 justify-center">
        {% for prereq in page.lxdData.Prequisites %}
          <li>
            <a href="{{ site.baseurl}}{{ prereq.link }}" class="prereq-button cute-text">
              {{ prereq.title }}
            </a>
          </li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}

    <div class="relative z-10">
      
      <!-- Node Title & Description -->
      <div class="text-center mb-20">
        <div class="inline-block relative mb-10">
          <h2 class="text-5xl md:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 via-pink-400 to-blue-400 cute-title">
            {{ page.lxdData.Title }}
          </h2>
          <div class="absolute -inset-2 bg-gradient-to-r from-purple-400 via-pink-400 to-blue-400 opacity-20 blur-xl rounded-lg"></div>
        </div>
        {% if page.lxdData.Description %}
        <p class="text-xl text-gray-300 max-w-4xl mx-auto leading-relaxed cute-text px-6">
          {{ page.lxdData.Description }}
        </p>
        {% endif %}
      </div>

      <!-- Progress Overview -->
      <div class="text-center mb-8">
        <div class="inline-flex items-center gap-4 bg-rgba(31, 41, 55, 0.8) rounded-2xl px-6 py-3 border border-purple-500/30">
          <span class="text-white cute-text">Journey Progress:</span>
          <span class="text-green-400 font-bold" id="overall-progress">City 1/4</span>
          <span class="text-purple-400" id="total-activities">Progress tracked across submodules</span>
        </div>
      </div>

      <!-- Travel Route with Cities and Buttons -->
      <div class="max-w-5xl mx-auto">
        {% if page.lxdData.Cities %}
          {% for city in page.lxdData.Cities %}
            
            <!-- City Card with integrated button -->
            <div class="city-card rounded-2xl shadow-lg relative" id="city-{{ forloop.index0 }}" data-city-index="{{ forloop.index0 }}">
              
              <!-- Progress indicator -->
              <div class="city-progress" id="progress-{{ forloop.index0 }}">
                🎯 Ready to explore
              </div>
              
              <!-- XP Reward indicator -->
              {% if city.XP_Reward %}
              <div class="city-xp">
                ⭐ {{ city.XP_Reward }} XP
              </div>
              {% endif %}
              
              <!-- City Title with Icon/Image support -->
              <div class="w-full mb-4">
                <h3 class="text-3xl xl:text-4xl font-bold text-white cute-heading flex items-center">
                  <!-- Icon/Image Display Logic -->
                  {% if city.Image %}
                    <span class="city-icon">
                      <img src="{{ site.baseurl }}{{ city.Image }}" 
                           alt="{{ city.Name }} icon" 
                           loading="lazy"
                           onclick="openImageModal('{{ site.baseurl }}{{ city.Image }}', '{{ city.Name }}')"
                           title="Click to view full image">
                    </span>
                  {% elsif city.Icon %}
                    <span class="city-icon emoji">{{ city.Icon }}</span>
                  {% endif %}
                  {{ city.Name }}
                </h3>
                {% if city.Theme %}
                <div class="city-theme cute-text">{{ city.Theme }}</div>
                {% endif %}
              </div>

              <!-- City Description -->
              <div class="w-full mb-6">
                {% if city.Description %}
                <p class="text-gray-300 text-lg leading-relaxed cute-text mb-4">{{ city.Description }}</p>
                {% endif %}
                {% if city.Challenge %}
                <div class="text-sm text-purple-400 cute-text mb-2">
                  🎯 <strong>Challenge:</strong> {{ city.Challenge }}
                </div>
                {% endif %}
                {% if city.Analogy %}
                <div class="text-sm text-blue-400 cute-text">
                  💡 <strong>Analogy:</strong> {{ city.Analogy }}
                </div>
                {% endif %}
              </div>

              <!-- Route Button inside card -->
              {% if forloop.index0 == 0 %}
                {% assign city_permalink = "/west-coast/food/SD" %}
              {% elsif forloop.index0 == 1 %}
                {% assign city_permalink = "/west-coast/food/LA" %}
              {% elsif forloop.index0 == 2 %}
                {% assign city_permalink = "/west-coast/food/SF" %}
              {% else %}
                {% assign city_permalink = "/west-coast/food/SEA" %}
              {% endif %}
              <a href="{{ site.baseurl }}{{ city_permalink }}" 
                 class="city-route-button {% if forloop.first %}start-journey{% endif %}" 
                 id="route-link-{{ forloop.index0 }}" 
                 data-route="{{ forloop.index0 }}" 
                 title="{% if forloop.first %}☀️ Start Your San Diego Journey!{% elsif forloop.index0 == 1 %}🌴 Explore Los Angeles{% elsif forloop.index0 == 2 %}🌁 Discover San Francisco{% else %}🌲 Reach Seattle{% endif %}">
                {% if forloop.first %}☀️{% elsif forloop.index0 == 1 %}🌴{% elsif forloop.index0 == 2 %}🌁{% else %}🌲{% endif %}
              </a>
              
            </div>

          {% endfor %}
        {% else %}
          <div class="text-center text-red-400">
            <p>No cities data found. Check your markdown file structure.</p>
          </div>
        {% endif %}
      </div>

      <!-- Instructions for Navigation -->
      <div class="text-center mt-12 mb-8">
        <div class="inline-block bg-rgba(31, 41, 55, 0.8) rounded-2xl px-8 py-4 border border-blue-500/30">
          <h3 class="text-lg font-bold text-white cute-heading mb-2">🗺️ How to Navigate</h3>
          <p class="text-gray-300 cute-text text-sm">
            Click on city images to view them full-screen, or click the emoji buttons in the bottom-right corner to enter that city's submodule.<br>
            Complete activities in order: San Diego → Los Angeles → San Francisco → Seattle
          </p>
        </div>
      </div>

      <!-- Back to Hub Button -->
      <div class="text-center mt-20">
        <a href="{{ site.baseurl }}/west-coast" class="prereq-button cute-text inline-block">
          🏠 Back to Main
        </a>
      </div>

    </div> 
  </div>  
</div>     

<!-- SHOWCASE WALLS (One for each city) -->
<div class="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900">
  <div class="container mx-auto px-8 py-16">
    <div class="max-w-5xl mx-auto mt-16">
      <div class="text-center mb-8">
        <h2 class="text-3xl font-bold text-white cute-heading mb-4">🎨 City Showcase Walls</h2>
        <p class="text-gray-400 cute-text">Complete cities to unlock their showcase walls and share your journey!</p>
      </div>

      <!-- San Diego Showcase Wall -->
      <div class="showcase-wall" id="showcase-0">
        <div class="showcase-header" onclick="toggleCityShowcase(0)">
          <div>
            <h3 class="text-lg font-bold text-white cute-heading flex items-center">
              ☀️ San Diego Showcase Wall
              <span id="showcase-count-0" class="ml-2 text-sm text-purple-400">(0 posts)</span>
            </h3>
            <p class="text-sm text-gray-400 cute-text">Share your CREATE journey and Baja Bowl experiences!</p>
          </div>
          <span class="showcase-toggle text-white">▼</span>
        </div>
        <div class="showcase-content" id="showcase-content-0">
          <div class="upload-form" id="upload-form-0" style="display: none;">
            <h4 class="text-lg font-bold text-white cute-heading mb-3">📸 Add to San Diego Wall</h4>
            <input type="file" class="upload-input" accept="image/*" placeholder="Choose image...">
            <textarea class="upload-textarea" placeholder="Share your San Diego experience, what you learned, or a fun memory!"></textarea>
            <button class="upload-button" onclick="uploadToCity(0)">📸 Add to San Diego Wall</button>
          </div>
          <div class="showcase-grid" id="showcase-grid-0"></div>
        </div>
      </div>

      <!-- Los Angeles Showcase Wall -->
      <div class="showcase-wall locked" id="showcase-1">
        <div class="showcase-header" onclick="toggleCityShowcase(1)">
          <div>
            <h3 class="text-lg font-bold text-white cute-heading flex items-center">
              🌴 Los Angeles Showcase Wall
              <span id="showcase-count-1" class="ml-2 text-sm text-purple-400">(0 posts)</span>
            </h3>
            <p class="text-sm text-gray-400 cute-text">Complete San Diego to unlock and share your READ adventures!</p>
          </div>
          <span class="showcase-toggle text-white">▼</span>
        </div>
        <div class="showcase-content" id="showcase-content-1">
          <div class="upload-form" id="upload-form-1" style="display: none;">
            <h4 class="text-lg font-bold text-white cute-heading mb-3">📸 Add to Los Angeles Wall</h4>
            <input type="file" class="upload-input" accept="image/*" placeholder="Choose image...">
            <textarea class="upload-textarea" placeholder="Share your Los Angeles experience and query mastery!"></textarea>
            <button class="upload-button" onclick="uploadToCity(1)">📸 Add to Los Angeles Wall</button>
          </div>
          <div class="showcase-grid" id="showcase-grid-1"></div>
        </div>
      </div>

      <!-- San Francisco Showcase Wall -->
      <div class="showcase-wall locked" id="showcase-2">
        <div class="showcase-header" onclick="toggleCityShowcase(2)">
          <div>
            <h3 class="text-lg font-bold text-white cute-heading flex items-center">
              🌁 San Francisco Showcase Wall
              <span id="showcase-count-2" class="ml-2 text-sm text-purple-400">(0 posts)</span>
            </h3>
            <p class="text-sm text-gray-400 cute-text">Complete Los Angeles to unlock and share your UPDATE journey!</p>
          </div>
          <span class="showcase-toggle text-white">▼</span>
        </div>
        <div class="showcase-content" id="showcase-content-2">
          <div class="upload-form" id="upload-form-2" style="display: none;">
            <h4 class="text-lg font-bold text-white cute-heading mb-3">📸 Add to San Francisco Wall</h4>
            <input type="file" class="upload-input" accept="image/*" placeholder="Choose image...">
            <textarea class="upload-textarea" placeholder="Share your San Francisco gourmet pop-up experiences!"></textarea>
            <button class="upload-button" onclick="uploadToCity(2)">📸 Add to San Francisco Wall</button>
          </div>
          <div class="showcase-grid" id="showcase-grid-2"></div>
        </div>
      </div>

      <!-- Seattle Showcase Wall -->
      <div class="showcase-wall locked" id="showcase-3">
        <div class="showcase-header" onclick="toggleCityShowcase(3)">
          <div>
            <h3 class="text-lg font-bold text-white cute-heading flex items-center">
              🌲 Seattle Showcase Wall
              <span id="showcase-count-3" class="ml-2 text-sm text-purple-400">(0 posts)</span>
            </h3>
            <p class="text-sm text-gray-400 cute-text">Complete San Francisco to unlock and share your DELETE & ANALYZE mastery!</p>
          </div>
          <span class="showcase-toggle text-white">▼</span>
        </div>
        <div class="showcase-content" id="showcase-content-3">
          <div class="upload-form" id="upload-form-3" style="display: none;">
            <h4 class="text-lg font-bold text-white cute-heading mb-3">📸 Add to Seattle Wall</h4>
            <input type="file" class="upload-input" accept="image/*" placeholder="Choose image...">
            <textarea class="upload-textarea" placeholder="Share your Seattle sustainable cleanup and analytics journey!"></textarea>
            <button class="upload-button" onclick="uploadToCity(3)">📸 Add to Seattle Wall</button>
          </div>
          <div class="showcase-grid" id="showcase-grid-3"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- IMAGE MODAL -->
<div id="imageModal" class="image-modal" onclick="closeImageModal()">
  <div class="image-modal-content" onclick="event.stopPropagation()">
    <button class="image-modal-close" onclick="closeImageModal()">×</button>
    <img id="modalImage" src="" alt="City Image">
    <div id="modalTitle" class="image-modal-title"></div>
  </div>
</div>

<script type="text/javascript">
// IMAGE MODAL FUNCTIONS
function openImageModal(imageSrc, cityName) {
  const modal = document.getElementById('imageModal');
  const modalImage = document.getElementById('modalImage');
  const modalTitle = document.getElementById('modalTitle');
  
  modalImage.src = imageSrc;
  modalTitle.textContent = cityName;
  modal.classList.add('show');
  
  // Prevent body scrolling when modal is open
  document.body.style.overflow = 'hidden';
}

function closeImageModal() {
  const modal = document.getElementById('imageModal');
  modal.classList.remove('show');
  
  // Restore body scrolling
  document.body.style.overflow = 'auto';
}

// Close modal with Escape key
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    closeImageModal();
  }
});

// CITY UNLOCKING SYSTEM (simplified for navigation)
let gameProgress = {
  unlockedCities: [0], // San Diego starts unlocked
  completedCities: [],
  totalCitiesCompleted: 0
};

// Load progress from localStorage
function loadGameProgress() {
  const saved = localStorage.getItem('city_progress');
  if (saved) {
    try {
      gameProgress = JSON.parse(saved);
    } catch (e) {
      console.error('Error loading game progress:', e);
      // Reset to defaults if corrupted
      gameProgress = {
        unlockedCities: [0],
        completedCities: [],
        totalCitiesCompleted: 0
      };
    }
  }
}

// Save progress to localStorage
function saveGameProgress() {
  try {
    localStorage.setItem('city_progress', JSON.stringify(gameProgress));
  } catch (e) {
    console.error('Error saving game progress:', e);
  }
}

// Initialize city locking on page load
function initializeCityLocking() {
  loadGameProgress();
  
  // Get all city cards and route buttons
  const cityCards = document.querySelectorAll('.city-card');
  const routeButtons = document.querySelectorAll('.city-route-button');
  
  // Lock all cities except unlocked ones
  cityCards.forEach((card, index) => {
    if (!gameProgress.unlockedCities.includes(index)) {
      lockCity(index);
    } else {
      unlockCity(index);
    }
  });
  
  // Lock route buttons for locked cities
  routeButtons.forEach((button, index) => {
    if (!gameProgress.unlockedCities.includes(index)) {
      lockCityButton(index);
    } else {
      unlockCityButton(index);
    }
  });
  
  updateProgressDisplay();
}

function lockCity(cityIndex) {
  const cityCard = document.getElementById(`city-${cityIndex}`);
  if (cityCard) {
    cityCard.classList.add('locked');
    cityCard.style.position = 'relative';
  }
}

function unlockCity(cityIndex) {
  const cityCard = document.getElementById(`city-${cityIndex}`);
  if (cityCard) {
    cityCard.classList.remove('locked');
    cityCard.classList.add('unlocked');
    
    // Show unlock notification if this is a new unlock
    if (cityIndex > 0) {
      showUnlockNotification(cityIndex);
    }
  }
}

function lockCityButton(routeIndex) {
  const routeButton = document.getElementById(`route-link-${routeIndex}`);
  
  if (routeButton) {
    routeButton.classList.add('locked');
    routeButton.title = 'Complete previous city to unlock';
    // Remove start-journey class if locked
    routeButton.classList.remove('start-journey');
    
    // Add click prevention
    routeButton.addEventListener('click', function(e) {
      e.preventDefault();
      alert('🔒 Complete the previous city first to unlock this route!');
    });
  }
}

function unlockCityButton(routeIndex) {
  const routeButton = document.getElementById(`route-link-${routeIndex}`);
  
  if (routeButton) {
    routeButton.classList.remove('locked');
    
    // Remove any click prevention
    routeButton.style.pointerEvents = 'auto';
    
    // Set appropriate title based on city
    const cityData = [
      { title: '☀️ Start Your San Diego Journey!' },
      { title: '🌴 Explore Los Angeles' },
      { title: '🌁 Discover San Francisco' },
      { title: '🌲 Reach Seattle' }
    ];
    
    const cityInfo = cityData[routeIndex] || { title: 'Click to explore this city' };
    routeButton.title = cityInfo.title;
    
    if (routeIndex === 0) {
      routeButton.classList.add('start-journey');
    }
  }
}

function showUnlockNotification(cityIndex) {
  const cityNames = ['San Diego', 'Los Angeles', 'San Francisco', 'Seattle'];
  const cityName = cityNames[cityIndex] || `City ${cityIndex + 1}`;
  
  const notification = document.createElement('div');
  notification.className = 'unlock-notification';
  notification.innerHTML = `🎉 ${cityName} Unlocked! Continue your journey!`;
  
  document.body.appendChild(notification);
  
  // Remove notification after 4 seconds
  setTimeout(() => {
    if (document.body.contains(notification)) {
      notification.style.animation = 'slideInDown 0.5s ease-out reverse';
      setTimeout(() => {
        document.body.removeChild(notification);
      }, 500);
    }
  }, 4000);
}

function updateProgressDisplay() {
  // Update overall progress
  const overallProgress = document.getElementById('overall-progress');
  const totalActivitiesElement = document.getElementById('total-activities');
  
  if (overallProgress) {
    overallProgress.textContent = `City ${gameProgress.unlockedCities.length}/4`;
  }
  
  if (totalActivitiesElement) {
    if (gameProgress.completedCities.length > 0) {
      totalActivitiesElement.textContent = `${gameProgress.completedCities.length} cities completed`;
    } else {
      totalActivitiesElement.textContent = 'Progress tracked across submodules';
    }
  }
  
  // Update city progress indicators
  gameProgress.completedCities.forEach(cityIndex => {
    const progressElement = document.getElementById(`progress-${cityIndex}`);
    if (progressElement) {
      progressElement.classList.add('completed');
      progressElement.textContent = '✅ Complete';
    }
  });
}

// Function to mark a city as completed (can be called from submodules)
function markCityCompleted(cityIndex) {
  if (!gameProgress.completedCities.includes(cityIndex)) {
    gameProgress.completedCities.push(cityIndex);
    gameProgress.totalCitiesCompleted++;
    
    // Unlock next city
    const nextCityIndex = cityIndex + 1;
    if (nextCityIndex < 4 && !gameProgress.unlockedCities.includes(nextCityIndex)) {
      gameProgress.unlockedCities.push(nextCityIndex);
      unlockCity(nextCityIndex);
      unlockCityButton(nextCityIndex);
    }
    
    saveGameProgress();
    updateProgressDisplay();
  }
}

// Expose function globally so submodules can call it
window.markCityCompleted = markCityCompleted;

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
  console.log('=== FOOD MODULE NAVIGATION SETUP ===');
  
  // Force reload progress from localStorage
  loadGameProgress();
  
  // Small delay to ensure DOM is fully ready
  setTimeout(() => {
    initializeCityLocking();
    
    // Debug logging
    console.log('Current game progress:', gameProgress);
    console.log('Unlocked cities:', gameProgress.unlockedCities);
    console.log('Completed cities:', gameProgress.completedCities);
  }, 100);
});

// Add a function to manually refresh progress (for debugging)
window.refreshCityProgress = function() {
  console.log('🔄 Manually refreshing city progress...');
  loadGameProgress();
  initializeCityLocking();
  console.log('Updated progress:', gameProgress);
};

// Showcase data for each city
let cityShowcaseData = [[], [], [], []]; // Array for each city

// Load showcase data
function loadCityShowcaseData() {
  const saved = localStorage.getItem('city_showcase_data');
  if (saved) {
    try {
      cityShowcaseData = JSON.parse(saved);
    } catch (e) {
      console.error('Error loading showcase data:', e);
      cityShowcaseData = [[], [], [], []];
    }
  }
}

// Save showcase data
function saveCityShowcaseData() {
  try {
    localStorage.setItem('city_showcase_data', JSON.stringify(cityShowcaseData));
  } catch (e) {
    console.error('Error saving showcase data:', e);
  }
}

// Toggle city showcase
window.toggleCityShowcase = function(cityIndex) {
  const content = document.getElementById(`showcase-content-${cityIndex}`);
  const toggle = content.parentElement.querySelector('.showcase-toggle');
  
  // Don't allow toggle if locked
  const showcaseWall = document.getElementById(`showcase-${cityIndex}`);
  if (showcaseWall.classList.contains('locked')) {
    return;
  }
  
  if (content.classList.contains('expanded')) {
    content.classList.remove('expanded');
    toggle.classList.remove('expanded');
  } else {
    content.classList.add('expanded');
    toggle.classList.add('expanded');
    renderCityShowcase(cityIndex);
  }
};

// Render city showcase
function renderCityShowcase(cityIndex) {
  const grid = document.getElementById(`showcase-grid-${cityIndex}`);
  const showcaseItems = cityShowcaseData[cityIndex] || [];
  
  if (showcaseItems.length === 0) {
    const cityNames = ['San Diego', 'Los Angeles', 'San Francisco', 'Seattle'];
    grid.innerHTML = `
      <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: #9ca3af;">
        <div style="font-size: 2rem; margin-bottom: 1rem;">🎨</div>
        <h4 style="font-size: 1.1rem; margin-bottom: 0.5rem; color: #e5e7eb;">No ${cityNames[cityIndex]} showcases yet!</h4>
        <p>Be the first to share your ${cityNames[cityIndex]} journey.</p>
      </div>
    `;
    return;
  }
  
  grid.innerHTML = showcaseItems.map((item, index) => `
    <div class="showcase-item">
      <img src="${item.image}" alt="Showcase" class="showcase-image" onclick="openImageModal('${item.image}', 'City Showcase')">
      <div class="showcase-caption">${item.caption}</div>
      <div class="showcase-meta">
        <span>${new Date(item.timestamp).toLocaleDateString()}</span>
      </div>
    </div>
  `).join('');
}

// Upload to city showcase
window.uploadToCity = function(cityIndex) {
  const uploadForm = document.getElementById(`upload-form-${cityIndex}`);
  const imageInput = uploadForm.querySelector('input[type="file"]');
  const captionInput = uploadForm.querySelector('textarea');
  const uploadBtn = uploadForm.querySelector('.upload-button');
  
  const caption = captionInput.value.trim();
  const imageFile = imageInput.files[0];
  
  if (!caption) {
    alert('Please add a caption for your showcase!');
    return;
  }
  
  if (!imageFile) {
    alert('Please select an image to upload!');
    return;
  }
  
  uploadBtn.disabled = true;
  uploadBtn.textContent = '📤 Uploading...';
  
  const reader = new FileReader();
  reader.onload = function(e) {
    const showcaseItem = {
      id: Date.now(),
      image: e.target.result,
      caption: caption,
      timestamp: new Date().toISOString()
    };
    
    cityShowcaseData[cityIndex].unshift(showcaseItem);
    saveCityShowcaseData();
    
    // Clear form
    captionInput.value = '';
    imageInput.value = '';
    
    // Re-render showcase
    renderCityShowcase(cityIndex);
    updateShowcaseCounts();
    
    // Show success
    if (typeof showToast !== 'undefined') {
      showToast('🎉 Added to showcase wall!', 3000);
    }
    
    uploadBtn.disabled = false;
    uploadBtn.textContent = '📸 Add to Showcase Wall';
  };
  
  reader.readAsDataURL(imageFile);
};

// Update showcase counts and unlock status
function updateShowcaseWalls() {
  for (let i = 0; i < 4; i++) {
    const showcaseWall = document.getElementById(`showcase-${i}`);
    const uploadForm = document.getElementById(`upload-form-${i}`);
    const cityCard = document.getElementById(`city-${i}`);
    
    if (gameProgress.completedCities.includes(i)) {
      // Unlock showcase wall
      showcaseWall.classList.remove('locked');
      uploadForm.style.display = 'block';
      
      // Add upload button to city card
      if (cityCard && !cityCard.querySelector('.city-upload-btn')) {
        const uploadBtn = document.createElement('div');
        uploadBtn.className = 'city-upload-btn show';
        uploadBtn.textContent = '📸 Share';
        uploadBtn.title = 'Add to Showcase Wall';
        uploadBtn.onclick = function() {
          toggleCityShowcase(i);
        };
        cityCard.appendChild(uploadBtn);
      }
    }
  }
  
  updateShowcaseCounts();
}

// Update showcase post counts
function updateShowcaseCounts() {
  for (let i = 0; i < 4; i++) {
    const countElement = document.getElementById(`showcase-count-${i}`);
    const count = cityShowcaseData[i] ? cityShowcaseData[i].length : 0;
    countElement.textContent = `(${count} post${count !== 1 ? 's' : ''})`;
  }
}

// Add toast function if not exists
if (typeof showToast === 'undefined') {
  window.showToast = function(message, duration = 3000) {
    const toast = document.createElement('div');
    toast.style.cssText = `
      position: fixed; top: 20px; right: 20px; background: linear-gradient(135deg, #10b981, #059669);
      color: white; padding: 12px 20px; border-radius: 8px; font-weight: 600; z-index: 10000;
    `;
    toast.textContent = message;
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), duration);
  };
}

// Initialize showcase data on page load
document.addEventListener('DOMContentLoaded', function() {
  loadCityShowcaseData();
  updateShowcaseCounts();
});

// Hook into existing updateProgressDisplay function
const originalUpdateProgressDisplay = updateProgressDisplay;
updateProgressDisplay = function() {
  originalUpdateProgressDisplay();
  updateShowcaseWalls();
};
</script>