<style>
/* Import cute fonts to match main project */
@import url('https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,300;0,400;0,600;0,700;0,800;1,400&family=Comic+Neue:ital,wght@0,300;0,400;0,700;1,400&display=swap');

/* Cute font applications to match main project */
.cute-title {
  font-family: 'Comic Neue', cursive;
  font-weight: 700;
}

.cute-text {
  font-family: 'Nunito', sans-serif;
  font-weight: 400;
}

.cute-heading {
  font-family: 'Nunito', sans-serif;
  font-weight: 700;
}

.cute-subheading {
  font-family: 'Nunito', sans-serif;
  font-weight: 600;
}

/* City cards - clean sections */
.city-card {
  background: linear-gradient(135deg, 
    rgba(55, 65, 81, 0.95) 0%, 
    rgba(75, 85, 99, 0.95) 50%, 
    rgba(55, 65, 81, 0.95) 100%);
  border: 2px solid rgba(139, 92, 246, 0.3);
  backdrop-filter: blur(10px);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  padding: 24px;
  margin: 16px 0;
  overflow: visible;
  transition: all 0.3s ease;
}

/* Travel route connector */
.travel-route {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin: 32px 0;
  position: relative;
}

.route-line {
  width: 4px;
  height: 60px;
  background: linear-gradient(to bottom, 
    rgba(139, 92, 246, 0.8) 0%,
    rgba(59, 130, 246, 0.8) 50%,
    rgba(139, 92, 246, 0.8) 100%);
  border-radius: 2px;
  position: relative;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 0.6; }
  50% { opacity: 1; }
}

/* ENHANCED: Clickable route button */
.route-button {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 24px;
  background: rgba(31, 41, 55, 0.95);
  padding: 12px;
  border-radius: 50%;
  border: 2px solid rgba(139, 92, 246, 0.5);
  cursor: pointer;
  transition: all 0.3s ease;
  z-index: 10;
}

.route-button:hover {
  background: rgba(139, 92, 246, 0.2);
  border-color: rgba(139, 92, 246, 0.8);
  transform: translate(-50%, -50%) scale(1.1);
  box-shadow: 0 4px 16px rgba(139, 92, 246, 0.3);
}

.route-button.active {
  background: rgba(139, 92, 246, 0.3);
  border-color: rgba(139, 92, 246, 1);
}

/* ENHANCED: Pitstops container with dropdown functionality */
.pitstops-section {
  background: linear-gradient(135deg, 
    rgba(31, 41, 55, 0.95) 0%, 
    rgba(55, 65, 81, 0.95) 100%);
  border: 2px solid rgba(59, 130, 246, 0.4);
  backdrop-filter: blur(10px);
  border-radius: 16px;
  padding: 20px;
  margin: 16px 0;
  box-shadow: 0 6px 24px rgba(0, 0, 0, 0.2);
  display: none; /* HIDDEN by default */
  opacity: 0;
  transform: translateY(-20px);
  transition: all 0.4s ease;
}

.pitstops-section.show {
  display: block;
  animation: slideDown 0.4s ease-out forwards;
}

@keyframes slideDown {
  0% {
    opacity: 0;
    transform: translateY(-20px) scaleY(0.8);
  }
  100% {
    opacity: 1;
    transform: translateY(0) scaleY(1);
  }
}

.pitstops-title {
  text-align: center;
  color: #60a5fa;
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.pitstops-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 16px;
}

.pitstop-item {
  background: rgba(59, 130, 246, 0.15);
  border: 1px solid rgba(59, 130, 246, 0.3);
  border-radius: 12px;
  padding: 16px;
  transition: all 0.3s ease;
  cursor: pointer;
}

.pitstop-item:hover {
  background: rgba(59, 130, 246, 0.25);
  border-color: rgba(59, 130, 246, 0.5);
  transform: translateY(-2px);
  box-shadow: 0 4px 16px rgba(59, 130, 246, 0.2);
}

.pitstop-name {
  font-family: 'Nunito', sans-serif;
  font-weight: 700;
  color: #93c5fd;
  font-size: 16px;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.pitstop-description {
  font-family: 'Nunito', sans-serif;
  font-weight: 400;
  color: #d1d5db;
  font-size: 14px;
  line-height: 1.5;
}

/* Data tag styling to match theme */
.data-tag {
  background: linear-gradient(135deg, #8b5cf6, #3b82f6);
  border: 2px solid rgba(139, 92, 246, 0.4);
  color: white;
  font-family: 'Nunito', sans-serif;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
  transition: all 0.3s ease;
}

.data-tag:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(139, 92, 246, 0.6);
  border: 2px solid rgba(139, 92, 246, 0.8);
}

/* Prerequisite button styling */
.prereq-button {
  background: linear-gradient(135deg, #8b5cf6, #3b82f6);
  border: 2px solid rgba(139, 92, 246, 0.4);
  padding: 12px 24px;
  border-radius: 25px;
  color: white;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-size: 12px;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
  position: relative;
  overflow: hidden;
  font-family: 'Nunito', sans-serif;
}

.prereq-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(139, 92, 246, 0.6);
  border: 2px solid rgba(139, 92, 246, 0.8);
}

.prereq-button::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transition: left 0.5s ease;
}

.prereq-button:hover::before {
  left: 100%;
}

@media (max-width: 768px) {
  .city-card {
    padding: 16px;
    margin: 12px 0;
  }
  
  .pitstops-grid {
    grid-template-columns: 1fr;
    gap: 12px;
  }
  
  .pitstop-item {
    padding: 12px;
  }
  
  .route-line {
    height: 40px;
  }
  
  .route-button {
    font-size: 18px;
    padding: 8px;
  }
}
</style>

<div class="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900">
  <div class="container mx-auto px-8 py-16">

    {% if page.lxdData.Prequisites %}
    <div class="mb-16 text-center">
      <h3 class="text-2xl font-bold text-white mb-8 cute-heading">üéØ Prerequisites</h3>
      <ul class="flex flex-wrap gap-8 justify-center">
        {% for prereq in page.lxdData.Prequisites %}
          <li>
            <a href="{{ site.baseurl}}{{ prereq.link }}" class="prereq-button cute-text">
              {{ prereq.title }}
            </a>
          </li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}

    <div class="relative z-10">
      
      <!-- Node Title & Description -->
      <div class="text-center mb-20">
        <div class="inline-block relative mb-10">
          <h2 class="text-5xl md:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 via-pink-400 to-blue-400 cute-title">
            {{ page.lxdData.Title }}
          </h2>
          <div class="absolute -inset-2 bg-gradient-to-r from-purple-400 via-pink-400 to-blue-400 opacity-20 blur-xl rounded-lg"></div>
        </div>
        {% if page.lxdData.Description %}
        <p class="text-xl text-gray-300 max-w-4xl mx-auto leading-relaxed cute-text px-6">
          {{ page.lxdData.Description }}
        </p>
        {% endif %}
      </div>

      <!-- Debug info -->
      <div class="text-center mb-8 text-yellow-400 cute-text">
        <p>Debug: Cities found: {% if page.lxdData.Cities %}{{ page.lxdData.Cities.size }}{% else %}0{% endif %}</p>
      </div>

      <!-- Travel Route with Cities and Pitstops -->
      <div class="max-w-4xl mx-auto">
        {% if page.lxdData.Cities %}
          {% for city in page.lxdData.Cities %}
            
            <!-- City Card -->
            <div class="city-card rounded-2xl shadow-lg">
              <!-- City Title -->
              <div class="w-full mb-4">
                <h3 class="text-3xl xl:text-4xl font-bold text-white cute-heading">
                  üèôÔ∏è {{ city.Name }}
                </h3>
              </div>

              <!-- City Description -->
              <div class="w-full">
                {% if city.Description %}
                <p class="text-gray-300 text-lg leading-relaxed cute-text mb-4">{{ city.Description }}</p>
                {% endif %}
                {% if city.Challenge %}
                <div class="text-sm text-purple-400 cute-text mb-2">
                  üéØ <strong>Challenge:</strong> {{ city.Challenge }}
                </div>
                {% endif %}
                {% if city.Analogy %}
                <div class="text-sm text-blue-400 cute-text">
                  üí° <strong>Analogy:</strong> {{ city.Analogy }}
                </div>
                {% endif %}
              </div>
            </div>

            <!-- Travel Route & Pitstops (only if not the last city) -->
            {% unless forloop.last %}
              <div class="travel-route">
                <div class="route-line">
                  <!-- ENHANCED: Clickable route button -->
                  <button class="route-button" data-route="{{ forloop.index0 }}" title="Click to explore pitstops">
                    üõ£Ô∏è
                  </button>
                </div>
              </div>

              <!-- ENHANCED: Hidden pitstops section -->
              {% if city.Pitstops and city.Pitstops.size > 0 %}
              <div class="pitstops-section" id="pitstops-{{ forloop.index0 }}">
                <div class="pitstops-title cute-subheading">
                  üó∫Ô∏è Travel Pitstops: {{ city.Name }} ‚Üí 
                  {% assign next_index = forloop.index %}
                  {% for next_city in page.lxdData.Cities %}
                    {% if forloop.index == next_index %}
                      {{ next_city.Name }}
                      {% break %}
                    {% endif %}
                  {% endfor %}
                </div>
                
                <div class="pitstops-grid">
                  {% for pitstop in city.Pitstops %}
                    <div class="pitstop-item">
                      <div class="pitstop-name">
                        üìç {{ pitstop.Name }}
                      </div>
                      <div class="pitstop-description">
                        {{ pitstop.Description }}
                      </div>
                    </div>
                  {% endfor %}
                </div>
              </div>
              {% endif %}
            {% endunless %}

          {% endfor %}
        {% else %}
          <div class="text-center text-red-400">
            <p>No cities data found. Check your markdown file structure.</p>
          </div>
        {% endif %}
      </div>

      <!-- Back to Hub Button -->
      <div class="text-center mt-20">
        <a href="{{ site.baseurl }}/project" class="prereq-button cute-text inline-block">
          üè† Back to Travel Hub
        </a>
      </div>

    </div>
  </div>
</div>

<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function() {
  console.log('=== ROUTE DROPDOWN SETUP ===');
  
  var routeButtons = document.querySelectorAll('.route-button');
  console.log('Found ' + routeButtons.length + ' route buttons');
  
  for (var i = 0; i < routeButtons.length; i++) {
    routeButtons[i].addEventListener('click', function(e) {
      console.log('Route button clicked!');
      
      var routeIndex = this.getAttribute('data-route');
      var pitstopsSection = document.getElementById('pitstops-' + routeIndex);
      
      console.log('Toggling pitstops-' + routeIndex);
      
      if (!pitstopsSection) {
        console.log('Pitstops section not found!');
        return;
      }
      
      var isVisible = pitstopsSection.classList.contains('show');
      console.log('Currently visible:', isVisible);
      
      // Close all other pitstops sections and reset buttons
      var allPitstops = document.querySelectorAll('.pitstops-section');
      var allButtons = document.querySelectorAll('.route-button');
      
      for (var j = 0; j < allPitstops.length; j++) {
        allPitstops[j].classList.remove('show');
      }
      
      for (var k = 0; k < allButtons.length; k++) {
        allButtons[k].classList.remove('active');
      }
      
      // Toggle current pitstops section
      if (!isVisible) {
        pitstopsSection.classList.add('show');
        this.classList.add('active');
        console.log('OPENED pitstops ' + routeIndex);
        
        // Smooth scroll to the pitstops section
        setTimeout(function() {
          pitstopsSection.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center' 
          });
        }, 200);
      } else {
        console.log('CLOSED pitstops ' + routeIndex);
      }
    });
  }
});
</script>